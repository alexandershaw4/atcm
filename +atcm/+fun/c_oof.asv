function m = c_oof(w,y,model)
% 2n order polyfit with constraint, where constraint is
%
% m = p(w,y) s.t
% m(1) = y(1) & m(end) = y(end)
%

if nargin < 3 || isempty(model)
    model = 'poly2';
end

w = w(:);
y = real(y(:));
c = [y(1) y(end)];

p = fit(w,y,model);
m = p(w);


m = [m(2:end); m(end)];
dy = spm_vec( linspace(c(1),c(2),length(w)) );
m  = rescale(m) .* dy;

m  = m + min(y - m);

m = [m(2:end); m(end)];
dy = spm_vec( linspace(c(1),c(2),length(w)) );
m  = rescale(m) .* dy;


end